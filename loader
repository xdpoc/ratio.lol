-- ratio.lol UI Library
-- A modern, mobile-friendly UI library for Robox

local RatioLib = {
    Version = "1.0.0",
    AccentColor = Color3.fromRGB(189, 172, 255),
    Flags = {},
    Connections = {},
    FontSizeMultiplier = 1,
    IsMobile = game:GetService("UserInputService").TouchEnabled and not game:GetService("UserInputService").MouseEnabled,
    OnAccentChange = Instance.new("BindableEvent"),
    OnConfigLoad = Instance.new("BindableEvent"),
}

-- Services
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local TextService = game:GetService("TextService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")

local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- Utility functions
local function GetTextSize(text, size, font)
    return TextService:GetTextSize(text, size, font, Vector2.new(1000, 1000))
end

local function Tween(obj, info, props)
    local tween = TweenService:Create(obj, info, props)
    tween:Play()
    return tween
end

local function New(class, props)
    local obj = Instance.new(class)
    for prop, val in pairs(props) do
        obj[prop] = val
    end
    return obj
end

local function FindInTable(tbl, value)
    for i, v in ipairs(tbl) do
        if v == value then
            return i
        end
    end
    return nil
end

-- Main GUI Holder
local ScreenGui = New("ScreenGui", {
    Name = "RatioLib",
    Parent = (gethui and gethui()) or CoreGui,
    ZIndexBehavior = Enum.ZIndexBehavior.Global,
    ResetOnSpawn = false,
    Enabled = false
})

-- Mobile toggle button
local MobileButton = New("TextButton", {
    Name = "MobileToggle",
    Parent = ScreenGui,
    Text = "RATIO",
    Font = Enum.Font.GothamBold,
    TextSize = 16,
    TextColor3 = Color3.new(1, 1, 1),
    BackgroundColor3 = RatioLib.AccentColor,
    BorderColor3 = Color3.new(0, 0, 0),
    BorderSizePixel = 2,
    Position = UDim2.new(0.85, 0, 0.9, 0),
    Size = UDim2.new(0, 80, 0, 40),
    Visible = true,
    ZIndex = 999
})

New("UICorner", {
    CornerRadius = UDim.new(0, 8),
    Parent = MobileButton
})

-- Make mobile button draggable
do
    local dragging = false
    local dragStart
    local startPos

    MobileButton.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = MobileButton.Position
        end
    end)

    MobileButton.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch and dragging then
            local delta = input.Position - dragStart
            MobileButton.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)

    MobileButton.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch then
            dragging = false
        end
    end)
end

-- ============= WINDOW CLASS =============
local Window = {}
Window.__index = Window

function Window.new(title)
    local self = setmetatable({}, Window)
    
    self.Title = title or "ratio.lol"
    self.Opened = false
    self.Tabs = {}
    self.ActiveTab = nil
    self.Hotkey = Enum.KeyCode.Insert
    self.FontSizeMultiplier = RatioLib.IsMobile and 1.2 or 1
    
    -- Main frame
    self.Main = New("Frame", {
        Parent = ScreenGui,
        BackgroundColor3 = Color3.new(0, 0, 0),
        BorderColor3 = Color3.new(0, 0, 0),
        BorderSizePixel = 0,
        Position = UDim2.new(0.5, -300, 0.5, -215),
        Size = UDim2.new(0, RatioLib.IsMobile and 700 or 600, 0, RatioLib.IsMobile and 500 or 430),
        Visible = true
    })
    
    New("UICorner", { CornerRadius = UDim.new(0, 4), Parent = self.Main })
    
    -- Border
    local border = New("Frame", {
        Parent = self.Main,
        BackgroundColor3 = Color3.new(32, 32, 32),
        BorderColor3 = Color3.new(0, 0, 0),
        BorderSizePixel = 0,
        Position = UDim2.new(0, 1, 0, 1),
        Size = UDim2.new(1, -2, 1, -2)
    })
    New("UICorner", { CornerRadius = UDim.new(0, 4), Parent = border })
    
    -- Inside
    self.Inside = New("Frame", {
        Parent = border,
        BackgroundColor3 = Color3.new(11, 11, 11),
        BorderColor3 = Color3.new(0, 0, 0),
        BorderSizePixel = 0,
        Position = UDim2.new(0, 1, 0, 1),
        Size = UDim2.new(1, -2, 1, -2)
    })
    New("UICorner", { CornerRadius = UDim.new(0, 4), Parent = self.Inside })
    
    -- Top bar
    self.TopBar = self:CreateTopBar()
    
    -- Tab holder
    self.TabHolder = New("Frame", {
        Parent = self.Inside,
        BackgroundColor3 = Color3.new(255, 255, 255),
        BackgroundTransparency = 1,
        BorderColor3 = Color3.new(0, 0, 0),
        BorderSizePixel = 0,
        Position = UDim2.new(0, 12, 0, 34),
        Size = UDim2.new(1, -24, 0, 360 * self.FontSizeMultiplier)
    })
    
    -- Subtab holder (left side)
    self.SubtabHolder = New("Frame", {
        Parent = self.TabHolder,
        BackgroundColor3 = Color3.new(8, 8, 8),
        BorderColor3 = Color3.new(32, 32, 32),
        Size = UDim2.new(0, 116 * self.FontSizeMultiplier, 1, 0)
    })
    
    self.SubtabInside = New("Frame", {
        Parent = self.SubtabHolder,
        BackgroundColor3 = Color3.new(255, 255, 255),
        BackgroundTransparency = 1,
        BorderColor3 = Color3.new(0, 0, 0),
        BorderSizePixel = 0,
        Position = UDim2.new(0, 6, 0, 6),
        Size = UDim2.new(1, -12, 1, -12)
    })
    
    self.SubtabLayout = New("UIListLayout", {
        Parent = self.SubtabInside,
        HorizontalAlignment = Enum.HorizontalAlignment.Center,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 3 * self.FontSizeMultiplier)
    })
    
    -- Bottom bar
    self:CreateBottomBar()
    
    -- Addon cover
    self.AddonCover = New("Frame", {
        Parent = self.Inside,
        BackgroundColor3 = Color3.new(1, 1, 1),
        BorderColor3 = Color3.new(0, 0, 0),
        BorderSizePixel = 0,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0, 25),
        Size = UDim2.new(1, 0, 1, -45),
        Visible = false,
        ZIndex = 14
    })
    
    -- Confirmation frame
    self.Confirmation = self:CreateConfirmationFrame()
    
    -- Close initially
    self:Close()
    
    return self
end

function Window:CreateTopBar()
    local topBar = New("Frame", {
        Parent = self.Inside,
        BackgroundColor3 = Color3.new(0, 0, 0),
        BorderColor3 = Color3.new(0, 0, 0),
        BorderSizePixel = 0,
        Position = UDim2.new(0, 1, 0, 1),
        Size = UDim2.new(1, -2, 0, 20 * self.FontSizeMultiplier)
    })
    New("UICorner", { CornerRadius = UDim.new(0, 4), Parent = topBar })
    
    local inside = New("Frame", {
        Parent = topBar,
        BackgroundColor3 = Color3.new(8, 8, 8),
        BorderColor3 = Color3.new(0, 0, 0),
        BorderSizePixel = 0,
        Position = UDim2.new(0, 1, 0, 1),
        Size = UDim2.new(1, -2, 1, -2)
    })
    New("UICorner", { CornerRadius = UDim.new(0, 4), Parent = inside })
    
    -- Title
    self.TitleLabel = New("TextLabel", {
        Parent = inside,
        BackgroundColor3 = Color3.new(255, 255, 255),
        BackgroundTransparency = 1,
        BorderColor3 = Color3.new(0, 0, 0),
        BorderSizePixel = 0,
        Position = UDim2.new(0, 5, 0, 0),
        Size = UDim2.new(0, 95, 1, 0),
        Font = Enum.Font.RobotoMono,
        Text = self.Title,
        TextColor3 = RatioLib.AccentColor,
        TextSize = 12 * self.FontSizeMultiplier,
        TextXAlignment = Enum.TextXAlignment.Left,
        RichText = true
    })
    
    -- Tab slider
    local tabSlider = New("Frame", {
        Parent = topBar,
        BackgroundColor3 = Color3.new(255, 255, 255),
        BackgroundTransparency = 1,
        BorderColor3 = Color3.new(0, 0, 0),
        BorderSizePixel = 0,
        ClipsDescendants = true,
        Position = UDim2.new(0, 106, 0, 1),
        Size = UDim2.new(1, -212, 1, 0)
    })
    
    self.TabHolder2 = New("Frame", {
        Parent = tabSlider,
        BackgroundColor3 = Color3.new(255, 255, 255),
        BackgroundTransparency = 1,
        BorderColor3 = Color3.new(0, 0, 0),
        BorderSizePixel = 0,
        Position = UDim2.new(-1, 0, 0, 0),
        Size = UDim2.new(1, 0, 1, 0)
    })
    
    self.TabLayout = New("UIListLayout", {
        Parent = self.TabHolder2,
        FillDirection = Enum.FillDirection.Horizontal,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 5)
    })
    
    -- Fade line
    self.FadeLine = New("Frame", {
        Parent = topBar,
        BackgroundColor3 = RatioLib.AccentColor,
        BorderColor3 = Color3.new(0, 0, 0),
        BorderSizePixel = 0,
        Position = UDim2.new(1, -298, 1, 1),
        Size = UDim2.new(0.5, 0, 0, 1)
    })
    
    New("UIGradient", {
        Color = ColorSequence.new{ColorSequenceKeypoint.new(0.00, Color3.new(11/255,11/255,11/255)), ColorSequenceKeypoint.new(1.00, Color3.new(1,1,1))},
        Parent = self.FadeLine
    })
    
    return topBar
end

function Window:CreateBottomBar()
    local bottomBar = New("Frame", {
        Parent = self.Inside,
        BackgroundColor3 = Color3.new(0, 0, 0),
        BorderColor3 = Color3.new(0, 0, 0),
        BorderSizePixel = 0,
        Position = UDim2.new(0, 1, 1, -21),
        Size = UDim2.new(1, -2, 0, 20 * self.FontSizeMultiplier)
    })
    New("UICorner", { CornerRadius = UDim.new(0, 4), Parent = bottomBar })
    
    local inside = New("Frame", {
        Parent = bottomBar,
        BackgroundColor3 = Color3.new(8, 8, 8),
        BorderColor3 = Color3.new(0, 0, 0),
        BorderSizePixel = 0,
        Position = UDim2.new(0, 1, 0, 1),
        Size = UDim2.new(1, -2, 1, -2)
    })
    New("UICorner", { CornerRadius = UDim.new(0, 4), Parent = inside })
    
    -- Tip image
    self.TipImage = New("ImageLabel", {
        Parent = inside,
        BackgroundColor3 = Color3.new(254, 254, 254),
        BackgroundTransparency = 1,
        BorderColor3 = Color3.new(0, 0, 0),
        BorderSizePixel = 0,
        Position = UDim2.new(0, 5, 0, 3),
        Size = UDim2.new(0, 12 * self.FontSizeMultiplier, 0, 12 * self.FontSizeMultiplier),
        ImageTransparency = 1,
        Image = "http://www.roblox.com/asset/?id=14151711445",
        ZIndex = 3
    })
    
    self.TipLabel = New("TextLabel", {
        Parent = self.TipImage,
        BackgroundColor3 = Color3.new(254, 254, 254),
        BackgroundTransparency = 1,
        BorderColor3 = Color3.new(0, 0, 0),
        BorderSizePixel = 0,
        Position = UDim2.new(0, 21, 0, 0),
        Size = UDim2.new(0, 350 * self.FontSizeMultiplier, 1, 0),
        Font = Enum.Font.RobotoMono,
        Text = "",
        TextColor3 = Color3.new(74/255, 74/255, 74/255),
        TextSize = 12 * self.FontSizeMultiplier,
        TextTransparency = 1,
        TextXAlignment = Enum.TextXAlignment.Left,
        ZIndex = 3
    })
    
    -- Build label
    self.BuildLabel = New("TextLabel", {
        Parent = inside,
        BackgroundColor3 = Color3.new(255, 255, 255),
        BackgroundTransparency = 1,
        BorderColor3 = Color3.new(0, 0, 0),
        BorderSizePixel = 0,
        Position = UDim2.new(0, 5, 0, 0),
        Size = UDim2.new(0, 95, 1, 0),
        Font = Enum.Font.RobotoMono,
        Text = "build: <font color=\"rgb(189, 172, 255)\">live</font>",
        TextColor3 = Color3.new(74/255, 74/255, 74/255),
        TextSize = 12 * self.FontSizeMultiplier,
        RichText = true,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    -- User label
    self.UserLabel = New("TextLabel", {
        Parent = inside,
        BackgroundColor3 = Color3.new(255, 255, 255),
        BackgroundTransparency = 1,
        BorderColor3 = Color3.new(0, 0, 0),
        BorderSizePixel = 0,
        Position = UDim2.new(1, -305 * self.FontSizeMultiplier, 0, 0),
        Size = UDim2.new(0, 300 * self.FontSizeMultiplier, 1, 0),
        Font = Enum.Font.RobotoMono,
        Text = "active user: <font color=\"rgb(189, 172, 255)\">"..LocalPlayer.Name.."</font>",
        TextColor3 = Color3.new(74/255, 74/255, 74/255),
        TextSize = 12 * self.FontSizeMultiplier,
        RichText = true,
        TextXAlignment = Enum.TextXAlignment.Right
    })
    
    New("UICorner", { CornerRadius = UDim.new(0, 4), Parent = inside })
end

function Window:CreateConfirmationFrame()
    local frame = New("Frame", {
        Parent = self.Main,
        BackgroundColor3 = Color3.new(0, 0, 0),
        BorderColor3 = Color3.new(0, 0, 0),
        BorderSizePixel = 0,
        Position = UDim2.new(0.5, -121, 0.5, -48),
        Size = UDim2.new(0, 242 * self.FontSizeMultiplier, 0, 96 * self.FontSizeMultiplier),
        Visible = false,
        ZIndex = 101
    })
    New("UICorner", { CornerRadius = UDim.new(0, 4), Parent = frame })
    
    local border = New("Frame", {
        Parent = frame,
        BackgroundColor3 = Color3.new(32, 32, 32),
        BorderColor3 = Color3.new(0, 0, 0),
        BorderSizePixel = 0,
        Position = UDim2.new(0, 1, 0, 1),
        Size = UDim2.new(1, -2, 1, -2),
        ZIndex = 101
    })
    New("UICorner", { CornerRadius = UDim.new(0, 4), Parent = border })
    
    local inside = New("Frame", {
        Parent = border,
        BackgroundColor3 = Color3.new(11, 11, 11),
        BorderColor3 = Color3.new(0, 0, 0),
        BorderSizePixel = 0,
        Position = UDim2.new(0, 1, 0, 1),
        Size = UDim2.new(1, -2, 1, -2),
        ZIndex = 101
    })
    New("UICorner", { CornerRadius = UDim.new(0, 4), Parent = inside })
    
    local top = New("Frame", {
        Parent = inside,
        BackgroundColor3 = Color3.new(0, 0, 0),
        BorderColor3 = Color3.new(0, 0, 0),
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, 20),
        ZIndex = 101
    })
    New("UICorner", { CornerRadius = UDim.new(0, 4), Parent = top })
    
    self.ConfirmationTop = New("TextLabel", {
        Parent = top,
        BackgroundColor3 = Color3.new(255, 255, 255),
        BackgroundTransparency = 1,
        BorderColor3 = Color3.new(0, 0, 0),
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 1, 0),
        ZIndex = 101,
        Font = Enum.Font.RobotoMono,
        Text = "Confirm",
        TextColor3 = RatioLib.AccentColor,
        TextSize = 12 * self.FontSizeMultiplier
    })
    
    self.ConfirmationText = New("TextLabel", {
        Parent = inside,
        BackgroundColor3 = Color3.new(255, 255, 255),
        BackgroundTransparency = 1,
        BorderColor3 = Color3.new(0, 0, 0),
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 1, -10),
        ZIndex = 101,
        Font = Enum.Font.RobotoMono,
        Text = "Are you sure?",
        TextColor3 = Color3.new(221/255, 221/255, 221/255),
        TextSize = 12 * self.FontSizeMultiplier,
        TextWrapped = true
    })
    
    -- Cancel button
    local cancelBtn = New("Frame", {
        Parent = inside,
        BackgroundColor3 = Color3.new(0, 0, 0),
        BorderColor3 = Color3.new(0, 0, 0),
        BorderSizePixel = 0,
        Position = UDim2.new(0, 34, 1, -33),
        Size = UDim2.new(0, 80 * self.FontSizeMultiplier, 0, 20 * self.FontSizeMultiplier),
        ZIndex = 101
    })
    New("UICorner", { CornerRadius = UDim.new(0, 3), Parent = cancelBtn })
    
    local cancelInside = New("Frame", {
        Parent = cancelBtn,
        BackgroundColor3 = Color3.new(254, 254, 254),
        BorderColor3 = Color3.new(0, 0, 0),
        BorderSizePixel = 0,
        Position = UDim2.new(0, 1, 0, 1),
        Size = UDim2.new(1, -2, 1, -2),
        ZIndex = 101
    })
    New("UICorner", { CornerRadius = UDim.new(0, 3), Parent = cancelInside })
    
    New("UIGradient", {
        Color = ColorSequence.new{ColorSequenceKeypoint.new(0.00, Color3.new(24/255,24/255,24/255)), ColorSequenceKeypoint.new(1.00, Color3.new(16/255,16/255,16/255))},
        Rotation = 90,
        Parent = cancelInside
    })
    
    local cancelLabel = New("TextLabel", {
        Parent = cancelInside,
        BackgroundColor3 = Color3.new(255, 255, 255),
        BackgroundTransparency = 1,
        BorderColor3 = Color3.new(0, 0, 0),
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 1, 0),
        ZIndex = 101,
        Font = Enum.Font.RobotoMono,
        Text = "Cancel",
        TextColor3 = Color3.new(74/255, 74/255, 74/255),
        TextSize = 12 * self.FontSizeMultiplier
    })
    
    -- Confirm button
    local confirmBtn = New("Frame", {
        Parent = inside,
        BackgroundColor3 = Color3.new(0, 0, 0),
        BorderColor3 = Color3.new(0, 0, 0),
        BorderSizePixel = 0,
        Position = UDim2.new(1, -114, 1, -33),
        Size = UDim2.new(0, 80 * self.FontSizeMultiplier, 0, 20 * self.FontSizeMultiplier),
        ZIndex = 101
    })
    New("UICorner", { CornerRadius = UDim.new(0, 3), Parent = confirmBtn })
    
    local confirmInside = New("Frame", {
        Parent = confirmBtn,
        BackgroundColor3 = Color3.new(254, 254, 254),
        BorderColor3 = Color3.new(0, 0, 0),
        BorderSizePixel = 0,
        Position = UDim2.new(0, 1, 0, 1),
        Size = UDim2.new(1, -2, 1, -2),
        ZIndex = 101
    })
    New("UICorner", { CornerRadius = UDim.new(0, 3), Parent = confirmInside })
    
    New("UIGradient", {
        Color = ColorSequence.new{ColorSequenceKeypoint.new(0.00, Color3.new(24/255,24/255,24/255)), ColorSequenceKeypoint.new(1.00, Color3.new(16/255,16/255,16/255))},
        Rotation = 90,
        Parent = confirmInside
    })
    
    local confirmLabel = New("TextLabel", {
        Parent = confirmInside,
        BackgroundColor3 = Color3.new(255, 255, 255),
        BackgroundTransparency = 1,
        BorderColor3 = Color3.new(0, 0, 0),
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 1, 0),
        ZIndex = 101,
        Font = Enum.Font.RobotoMono,
        Text = "Confirm",
        TextColor3 = Color3.new(74/255, 74/255, 74/255),
        TextSize = 12 * self.FontSizeMultiplier
    })
    
    -- Button interactions
    local confirmSignal = Instance.new("BindableEvent")
    local isHolding = false
    
    cancelBtn.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            isHolding = true
            cancelLabel.TextColor3 = RatioLib.AccentColor
            cancelBtn.BackgroundColor3 = RatioLib.AccentColor
        end
    end)
    
    cancelBtn.InputEnded:Connect(function(input)
        if (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) and isHolding then
            isHolding = false
            cancelLabel.TextColor3 = Color3.new(74/255, 74/255, 74/255)
            cancelBtn.BackgroundColor3 = Color3.new(0, 0, 0)
            frame.Visible = false
            self.AddonCover.Visible = false
            confirmSignal:Fire(false)
        end
    end)
    
    confirmBtn.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            isHolding = true
            confirmLabel.TextColor3 = RatioLib.AccentColor
            confirmBtn.BackgroundColor3 = RatioLib.AccentColor
        end
    end)
    
    confirmBtn.InputEnded:Connect(function(input)
        if (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) and isHolding then
            isHolding = false
            confirmLabel.TextColor3 = Color3.new(74/255, 74/255, 74/255)
            confirmBtn.BackgroundColor3 = Color3.new(0, 0, 0)
            frame.Visible = false
            self.AddonCover.Visible = false
            confirmSignal:Fire(true)
        end
    end)
    
    return {
        Frame = frame,
        Signal = confirmSignal
    }
end

function Window:Open()
    self.Opened = true
    ScreenGui.Enabled = true
    MobileButton.Visible = false
    
    Tween(self.FadeLine, TweenInfo.new(0.65, Enum.EasingStyle.Quad), {
        Position = UDim2.new(1, -298, 1, 1),
        Size = UDim2.new(0.5, 0, 0, 1)
    })
    
    Tween(self.TabHolder2, TweenInfo.new(0.45, Enum.EasingStyle.Quad), {
        Position = UDim2.new(0, 0, 0, 0)
    })
    
    -- Animate all elements
    for _, descendant in ipairs(self.Main:GetDescendants()) do
        if descendant:IsA("Frame") and descendant.BackgroundColor3 == Color3.new(1,1,1) then
            -- Skip
        elseif descendant:IsA("Frame") then
            Tween(descendant, TweenInfo.new(0.24), { BackgroundTransparency = 0 })
        elseif descendant:IsA("TextLabel") and descendant.BackgroundColor3 ~= Color3.new(254/255,254/255,254/255) then
            Tween(descendant, TweenInfo.new(0.24), { TextTransparency = 0 })
        elseif descendant:IsA("ImageLabel") and descendant.BackgroundColor3 ~= Color3.new(254/255,254/255,254/255) then
            Tween(descendant, TweenInfo.new(0.24), { ImageTransparency = 0 })
        elseif descendant:IsA("ScrollingFrame") then
            Tween(descendant, TweenInfo.new(0.24), { ScrollBarImageTransparency = 0 })
        end
    end
end

function Window:Close()
    self.Opened = false
    
    Tween(self.FadeLine, TweenInfo.new(0.65, Enum.E
